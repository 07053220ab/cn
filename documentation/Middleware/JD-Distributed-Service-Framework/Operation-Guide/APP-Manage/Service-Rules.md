# 服务路由

使用微服务平台用户，在应用的部署过程中，可通过服务路由功能，按照所需在不同的实例上定制化分配流量。其中，就进路由和容错保护，对整个命名空间生效。


## 环境准备

需提前配置环境依赖项，请参考： [微服务平台 spring cloud 插件说明](../../Getting-Started/JDSF-Plugin.md)


# 操作步骤
### 新建路由规则
1、登录微服务平台控制台。	在左侧导航栏点击应用管理，进入服务治理列表。在列表中的应用，即用户可进行服务治理的应用。

![](../../../../../image/Internet-Middleware/JD-Distributed-Service-Framework/ser-list-20191211.png)

2、点击操作中的路由策略，对应用进行路由策略配置。

![](../../../../../image/Internet-Middleware/JD-Distributed-Service-Framework/lycl-list.png)

3、点击新建路由策略。每条策略最多支持15条规则。

![](../../../../../image/Internet-Middleware/JD-Distributed-Service-Framework/lycl-new.png)


| 概念 | 说明 |
| :- | :- |
| 流量来源方信息 | 流量的请求发起方信息表达式。 |
| 流量目的方信息 | 流量的接收方信息表达式。注意需要确保权重加总为100。 |
| 策略优先级 | 数值越大，策略越优先。 |

若请求样本过少可能会产生偏差，如需达到预期配置请求比例效果，需配置至少1000条以上才可达到。

4、默认开启就进路由和容错保护。用户可自行关闭。

### 启用路由规则

在路由策略列表页的路由策略状态列中，可直接操作开启或关闭路由策略。

1、配置后默认10s后生效，如需修改生效时间可在SDK中进行配置。

2、开启容错保护后，会实现兜底策略，若配置规则无匹配实例，将返回默认可用实例。

例如假设服务设置了如下路由规则， 并且v1.0 版本的实例全部不可用：

-  20%的流量分配到 v1.0 版本。

-  30%的流量分配到 v2.0 版本。

-  50%的流量请求分配到 v3.0 版本。

请求结果：

- 流量会直接请求到v2.0和v3.0版本，最终结果将大约按照40%和60%的比例分别请求到v2.0和v3.0版本。

- 如果配置的流量来源方规则是匹配的，但流量目的方规则无匹配值，则会随机选择目的服务可用实例，并走默认轮询策略返回。


### 编辑路由规则

1、登录微服务平台控制台。	在左侧导航栏点击应用管理，进入服务治理列表。

2、点击操作中的编辑，即可对已存在路由规则进行编辑操作。


### 删除路由规则

1、登录微服务平台控制台。	在左侧导航栏点击应用管理，进入服务治理列表。

2、点击操作中的删除。删除后默认10s后生效，如需修改可在SDK中进行配置。

