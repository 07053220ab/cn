## 		语音异步检测接口

本文提供了调用语音检测任务的具体内容，旨在帮助您编写程序构建HTTP调用请求。

- 关于如何构造HTTP请求，请参见[请求结构](https://docs.jdcloud.com/cn/common-declaration/api/call-methods)。

### 描述

提交异步检测语音检测任务。支持对语音流或语音文件进行检测，判断其中是否包含违规内容。

**说明** 语音异步检测默认使用中文语音检测引擎。

检测任务提交成功后，可以通过调用查询异步语音检测任务接口获取检测结果，您也可以通过callback方式设置回调接口来获取检测结果。

**语音文件限制说明**

- 支持的语音文件大小 < 100 M
- 支持的音频文件格式：.mp3、.wav、.aac、.wma、.ogg、.m4a、.amr、.audio
- 支持的视频文件格式：.avi、.flv、.mp4、.mpg、.asf、.wmv、.mov、.rmvb、.rm

关于scene与label参数

在提交检测任务时，您需要指定**scenes**场景参数；而在检测返回结果中，则包含了您指定的场景对应的**label**分类参数。

在语音反垃圾中，scene与label的对应关系如下：

| 功能           | 描述                                           | scene    | label                                                        |
| :------------- | :--------------------------------------------- | :------- | :----------------------------------------------------------- |
| 语音反垃圾检测 | 识别语音中的违规内容。<br />（默认语音是中文） | antispam | normal：正常文本 <br />politics：涉政<br />terrorism：暴恐<br />porn：色情 |

### 请求方式

POST

### 请求地址

 /censor/voice/asyncscan

### 请求参数

| 名称     | 是否必须 | 类型          | 描述                                                         |
| :------- | :------- | :------------ | :----------------------------------------------------------- |
| bizType  | 否       | 字符串        | 该字段用于标识业务场景。针对不同的业务场景，您可以配置不同的内容审核策略，以满足不同场景下不同的审核标准或算法策略的需求。 |
| scenes   | 是       | 字符串数组    | antispam                                                     |
| live     | 否       | 布尔型        | 是否为直播流。默认为false，表示为普通语音文件检测；若需要检测语音流，该值必须传入true。 |
| callback | 否       | 字符串        | 异步检测结果回调通知您的URL，支持HTTP/HTTPS。该字段为空时，您必须定时检索检测结果。 |
| seed     | 否       | 字符串        | 随机字符串，该值用于回调通知请求中的签名。当使用callback时，该字段必须提供。 |
| tasks    | 是       | voiceTask数组 | 检测任务列表，JSON数组中的每个元素是一个结构体，最多支持100个元素。每个元素的具体机构建voiceTask |

##### voiceTask

| 名称       | 是否必须 | 类型       | 描述                                                         |
| :--------- | :------- | :--------- | :----------------------------------------------------------- |
| clientInfo | 否       | JSON结构体 | 客户端信息                                                   |
| dataId     | 否       | 布尔型     | 是否为直播流。默认为false，表示为普通语音文件检测；若需要检测语音流，该值必须传入true。 |
| url        | 是       | 字符串     | 需要检测的语音文件或语音流下载地址。                         |
| extras     | 否       | JSON对象   | 扩展字段                                                     |

### 音频审核-异步检测通知回调

##### callback说明

如果您在请求参数中指定了回调通知参数callback，被回调callback值，即一个HTTP(S)协议接口的URL，则需要支持POST方法，传输数据编码采用utf-8，并且支持两个表单参数**checksum**和**content**。系统将按以下描述的生成规则和格式设置checksum和content的值，调用您的callback接口返回检测内容。

您服务端接收到我们推送的结果后，返回的HTTP状态码为200时，表示推送成功，其他的HTTP状态码均视为您接收失败，我们将最多重复推送16次。

callback表

| 参数名称 | 类型   | 描述                                                         |
| :------- | :----- | :----------------------------------------------------------- |
| checksum | 字符串 | 由用户uid + seed + content拼成字符串，通过SHA256算法生产。用户UID即账号ID，您可在京东智联云控制台上查询。为防篡改，您可以在获取到推送结果时，按此算法生成字符串，与checksum做一次校验。 |
| content  | String | JSON字符串格式，请自行解析反转成JSON对象。content结果格式参见下文 |

### 返回参数

##### data

| 参数名称 | 是否必须 | 类型   | 描述                                                         |
| :------- | :------- | :----- | :----------------------------------------------------------- |
| code     | 否       | 整型   | 错误码，和HTTP的status code一致。                            |
| msg      | 是       | 布尔型 | 是否为直播流。默认为false，表示为普通语音文件检测；若需要检测语音流，该值必须传入true。 |
| dataId   | 否       | 字符串 | 对应请求中的dataId。                                         |
| taskId   | 是       | 字符串 | 该检测任务的ID。                                             |



#### 请求示例

```
{
    "scenes":["antispam"],
    "live":true,
    "tasks":[
        {
            "dataId":"1a90c9d6-6a81-42db-bbe1-e36102f3dd5e",
            "url":"http://xxxxx.com/test.mp3"
        }
    ]
}
```

#### 返回示例

```
{
	"msg": "OK",
	"code": 200,
	"result": {
		"data": [{
			"msg": "OK",
			"code": 200,
			"dataId": "1a90c9d6-6a81-42db-bbe1-e36102f3dd5e",
			"taskId": "xxxx"
		}]
	},
	"requestId": "yyyyyyyy-862F-4BAE-8B4E-xxxxxxx"
}
```



## 查询语音异步检测结果

### 描述

如果您在提交语音异步检测任务时未设置callback地址，则需要调用本接口轮询检测结果。

- 对于语音文件检测任务，每次查询或者通过callback方式都会返回已检测完的语音检测结果（仅返回已检测完成的任务检测结果）。建议您将查询间隔设置为30秒，检测结果保留4个小时，并及时查询并保存结果。
- 对于语音流检测任务，每次轮询会返回最近10段检测到的语音内容检测结果，建议您将查询间隔设置为30秒；如果通过callback的方式获取语音流检测结果，系统每次检测出语音内容后都会发送回调通知。

### 请求方式

POST

### 请求地址

/censor/voice/results

#### 请求参数体

| 参数名称 | 是否必须 | 类型       | 描述                                      |
| :------- | :------- | :--------- | :---------------------------------------- |
| body     | 是       | 字符串数组 | 要查询的taskId列表。最大长度不超过1,000。 |

#### 响应参数体

##### Data

| 参数名称 | 是否必须 | 类型     | 描述                                                         |
| :------- | :------- | :------- | :----------------------------------------------------------- |
| code     | 否       | 整型     | 错误码，和HTTP的status code一致。                            |
| msg      | 是       | 布尔型   | 是否为直播流。默认为false，表示为普通语音文件检测；若需要检测语音流，该值必须传入true。 |
| dataId   | 否       | 字符串   | 对应请求中的dataId。                                         |
| taskId   | 是       | 字符串   | 该检测任务的ID。                                             |
| results  | 否       | 数组     | 返回结果。调用成功时（code=200），返回结果中包含一个或多个元素。每个元素是个结构体，具体结构描述见result。 |
| extras   | 否       | JSON对象 | 附加信息，扩展字段。                                         |

##### result

| 参数名称   | 是否必须 | 类型       | 描述                                                         |
| :--------- | :------- | :--------- | :----------------------------------------------------------- |
| scene      | 是       | 字符串     | 检测场景，和调用请求中的场景对应。                           |
| label      | 是       | 字符串     | 检测结果的分类，与具体的scene对应。取值范围参考scene 和 label说明。 |
| score      | 是       | 字符串     | 结果为该分类的概率，取值范围为[0.00-100.00](https://cf.jd.com/pages/0.00-100.00)。值越高，表示越有可能属于该分类subLabel。 |
| suggestion | 是       | 字符串     | pass，review，block                                          |
| extras     | 否       | JSON对象   | 附加信息，扩展字段。                                         |
| details    | 否       | detail数组 | 语音对应的文本详情。每一句文本对应一个元素，包含一个或者多个元素，每个元素的具体结构见 |

##### detail

| 参数名称       | 是否必须 | 类型         | 描述                                                         |
| :------------- | :------- | :----------- | :----------------------------------------------------------- |
| startTime      | 是       | 整型         | 句子开始的时间，单位是秒。                                   |
| endTime        | 是       | 整型         | 句子结束的时间，单位是秒。                                   |
| text           | 是       | 字符串       | 语音转换成文本的结果。                                       |
| label          | 是       | 字符串       | 检测结果的分类，与具体的scene对应。取值范围参考scene 和 label说明。 |
| hintWordsInfos | 是       | hintWord数组 | 语音中包含的文本命中的风险关键词信息，用于提示您违规的原因，可能返回多个命中的关键词。具体结构描述见hintWordsInfo。 |

##### hintWordsInfo

| 参数名称 | 是否必须 | 类型   | 描述                                                         |
| :------- | :------- | :----- | :----------------------------------------------------------- |
| context  | 是       | 字符串 | 检测文本命中的风险内容上下文内容。如果命中了您自定义的风险文本库，则会返回命中的文本内容（关键词或相似文本）。 |
| libName  | 否       | 字符串 | 命中自定义词库时，才有本字段。取值为创建词库时填写的词库名称。 |
| libCode  | 否       | 字符串 | 命中您自定义文本库时，才会返回该字段，取值为创建风险文本库后系统返回的文本库code。 |

#### 请求示例

```
[
    "taskId1"
]
```

#### 响应示例

```
{
    "msg":"OK",
    "code":200,
    "data":[
        {
            "code":200,
            "dataId":"3b4b73b1-0152-4aa6-83ad-33730ba8a5e5",
            "taskId":"vc_f_1OsjIYTukH@4@AXkIQ9Oyh-1ov52Y",            
            "results":[
                {
                    "scene":"antispam",
                    "label": "politics",
                    "score":99.91,
                    "suggestion":"review",
                    "extras":{},
                    "details":[
                        {
                            "startTime":0,
                            "endTime":4065,
                            "text":"奥巴马特朗普",
                            "label":"politics",                            
                            "hintWords":{
                                [
                                    "context":"奥巴马",
                                ], [
                                    "context":"奥巴马",
                                    "libCode":"111",
                                    "libName":"name"
                                ]
                            }
                        }
                    ]                    
                }
            ]            
        }
    ],
    "requestId":"5A7A6198-6960-4DDC-B67E-58A6F1A4B20F"
}
```