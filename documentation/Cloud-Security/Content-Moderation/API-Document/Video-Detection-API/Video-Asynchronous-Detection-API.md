## 		视频异步检测接口

本文提供了调用视频风险违规内容审核的接口和参数说明，旨在帮助您编写程序构建HTTP调用请求，有效地检测视频中的多维度风险内容。关于如何构造HTTP请求，请参见OpenAPI内的请求结构。

### 描述

异步检测视频文件或视频流中是否包含违规内容。

支持检测的场景包括：视频智能鉴黄、视频暴恐涉政识别。

 异步检测结果需要通过调用查询视频审核检测结果接口进行查询或者通过callback的方式进行接收，检测结果最多保留**XXX**个小时。 

关于scene与label参数

在提交检测任务时，您需要指定**scenes**

**说明**  该接口为收费接口。同时检测多个场景的情况下，将按照“每个场景的检测视频截帧数量×每个场景的单价”进行累加计费。如果您同时检测视频中的语音违规内容，则还将增加“视频时长×语音违规功能的单价”的费用，具体请参见计费说明 。 

在视频审核中，scene与label的对应关系如下：

|                  | 描述                         | scene     | label                                                  |
| ---------------- | :--------------------------- | :-------- | :----------------------------------------------------- |
| 视频智能鉴黄     | 识别视频是否为色情视频。     | porn      | normal：正常视频，无色情内容<br />porn：色情视频<br /> |
| 视频暴恐涉政识别 | 识别视频是否为暴恐涉政视频。 | terrorism | normal：正常视频  <br />terrorist：涉恐暴恐视频<br />  |

关于audioScenes与label参数

在提交检测任务时且通过视频URL方式传入视频时，可以同时对视频中的语音内容进行违规检测。您需要指定**audioScenes**语音检测场景参数；而在检测返回结果中，则包含您指定的场景对应的**label**结果分类参数。

在视频语音检测中，audioScenes与label的对应关系如下：

| 场景                 | 描述                                                         | scenes   | label                                                        |
| :------------------- | :----------------------------------------------------------- | :------- | :----------------------------------------------------------- |
| 视频中语音内容反垃圾 | 识别视频中的语音内容是否包含违规信息。<br />**说明** 默认识别语言为中文。 | antispam | normal：正常文本<br />politics：涉政<br />terrorism：暴恐<br />porn：色情 |

**视频限制**

- 视频文件链接支持以下协议：HTTP和HTTPS。
- 视频文件支持以下格式：.avi、.flv、.mp4、.mpg、.asf、.wmv、.mov、.wma、.rmvb、.rm、.flash、.mid、.ts。
- 视频大小限制：单个视频大小不超过500MB。如果您有特殊需求（大视频），可以提工单进行调整。
- 视频检测的时间依赖于视频的下载时间。请保证被检测的视频文件所在的存储服务稳定可靠，建议您使用京东云OSS存储服务存储视频文件。

#### 请求方式

POST

#### **请求参数**

/censor/video/asyncscan

#### 请求参数体

| 参数名称    | 是否必须 | 类型          | 描述                                                         |
| :---------- | :------- | :------------ | :----------------------------------------------------------- |
| bizType     | 否       | 字符串        | 该字段用于标识业务场景。针对不同的业务场景，您可以配置不同的内容审核策略，以满足不同场景下不同的审核标准或算法策略的需求。 |
| scenes      | 否       | 字符串数组    | 待定审核场景？？                                             |
| live        | 否       | 布尔型        | 是否直播。默认为false，表示为普通视频检测；若为直播检测，该值必须传入true。 |
| audioScenes | 否       | 字符串数组    | 选择一个或多个语音检测场景，在检测视频中图像的同时，对视频中语音进行检测。可选值：antispam（语音反垃圾）。 |
| callback    | 否       | 字符串        | 异步检测结果回调通知您的URL，支持HTTP/HTTPS。该字段为空时，您必须定时检索检测结果。 |
| seed        | 否       | 字符串        | 随机字符串，该值用于回调通知请求中的签名。当使用callback时，该字段必须提供。 |
| tasks       | 是       | videoTask数组 | 检测任务列表，JSON数组中的每个元素是一个结构体，最多支持100个元素。每个元素的具体机构见videoTask |

##### videoTask

| 参数名称    | 是否必须 | 类型       | 描述                                                         |
| :---------- | :------- | :--------- | :----------------------------------------------------------- |
| clientInfo  | 否       | JSON结构体 | 客户端信息                                                   |
| dataId      | 否       | 字符串     | 数据Id。需要保证在一次请求中所有的Id不重复。                 |
| url         | 否       | 字符串     | 需要检测的视频文件或视频流下载地址。                         |
| frames      | 否       | frame数组  | 截帧信息。frames中的每个元素是个结构体（frame表），每个元素的具体结构描述见frame。。 |
| framePrefix | 否       | 字符串     | 当frames存在时，截帧的完整URL为：framePrefix + frame.url     |
| interval    | 否       | 整型       | 视频截帧间隔，单位为秒，取值范围为[1, 60](https://cf.jd.com/pages/1, 60)。默认值为1秒。 |
| maxFrames   | 否       | 整型       | 系统对本次检测的视频进行截帧的张数上限，取值范围为[5,3600](https://cf.jd.com/pages/5,3600)，默认为200张。如需调整到更大，请通过工单联系我们。 |
| extras      | 否       | 字符串     | 扩展字段                                                     |

##### frame

| 参数名称 | 是否必须 | 类型   | 描述                                                         |
| :------- | :------- | :----- | :----------------------------------------------------------- |
| url      | 否       | 字符串 | 截帧地址。当framePrefix存在时，完整的截帧地址为：framePrefix + url |
| offset   | 否       | 整型   | 该截帧距离片头的时间戳，单位为秒。                           |

### 视频审核-异步检测通知回调

**callback说明**

如果您在请求参数中指定了回调通知参数**callback**、被回调**callback**值，即一个http(s)协议接口的URL，则需要支持POST方法，传输数据编码采用utf-8，并且支持两个表单参数**checksum**和**content**。系统将按以下描述的生成规则和格式设置**checksum**和**content**的值，调用您的callback接口返回检测内容。

您服务端接收到我们推送的结果后，返回的HTTP状态码为200时，表示推送成功，其他的HTTP状态码均视为您接收失败，我们将最多重复推送16次。

#### 请求参数体

| 参数名称 | 类型   | 描述                                                         |
| :------- | :----- | :----------------------------------------------------------- |
| checksum | 字符串 | 由用户uid + seed + content拼成字符串，通过SHA256算法生产。用户UID即账号ID，您可在阿里云控制台上查询。为防篡改，您可以在获取到推送结果时，按此算法生成字符串，与checksum做一次校验。 |
| content  | String | JSON字符串格式，请自行解析反转成JSON对象。content结果格式参见下文 |



#### 响应参数体

##### data

| 参数名称 | 是否必须 | 类型   | 描述                                                         |
| :------- | :------- | :----- | :----------------------------------------------------------- |
| code     | 否       | 整型   | 错误码，和HTTP的status code一致。                            |
| msg      | 是       | 布尔型 | 是否为直播流。默认为false，表示为普通语音文件检测；若需要检测语音流，该值必须传入true。 |
| dataId   | 否       | 字符串 | 对应请求中的dataId。                                         |
| taskId   | 是       | 字符串 | 该检测任务的ID。                                             |

#### 请求示例

```
{
  "scenes":["porn"],
  "audioScenes":["antispam"],
  "tasks":[
    {
      "dataId":"videoId xxx",
      "url":"http://www.foo.bak/a.mp4",
      "interval":1,
      "maxFrames":200
    }
  ]
}
```

#### 返回示例

```
{
	"msg": "OK",
	"code": 200,
	"result": {
		"data": [{
			"msg": "OK",
			"code": 200,
			"dataId": "xxxx$rdBjUC1C-1rd9Ah",
			"taskId": "xxxx"
		}]
	},
	"requestId": "yyyyyyyy-862F-4BAE-8B4E-xxxxxxx"
}
```



### 查询视频异步检测结果

### 描述

 查询异步检测的结果。建议您将查询间隔设置为30秒，最长不能超过4个小时，否则结果将会消失。 本接口为免费接口

### 请求方式

POST

### 请求参数

/censor/video/results

#### 请求参数体

| 参数名称 | 是否必须 | 类型       | 描述                                      |
| :------- | :------- | :--------- | :---------------------------------------- |
| body     | 是       | 字符串数组 | 要查询的taskId列表。最大长度不超过1,000。 |

#### 响应参数体

##### Data

| 参数名称         | 是否必须 | 类型     | 描述                                                         |
| :--------------- | :------- | :------- | :----------------------------------------------------------- |
| code             | 否       | 整型     | 错误码，和HTTP的status code一致。                            |
| msg              | 是       | 布尔型   | 是否为直播流。默认为false，表示为普通语音文件检测；若需要检测语音流，该值必须传入true。 |
| dataId           | 否       | 字符串   | 对应请求中的dataId。                                         |
| taskId           | 是       | 字符串   | 该检测任务的ID。                                             |
| results          | 否       | 数组     | 返回结果。调用成功时（code=200），返回结果中包含一个或多个元素。每个元素是个结构体，具体结构描述见result。 |
| audioScanResults | 否       | JSON对象 | 视频语音检测结果。具体结构描述见audioScanResult。            |
| extras           | 否       | JSON对象 | 附加信息，扩展字段。                                         |

##### result

| 参数名称       | 是否必须 | 类型              | 描述                                                         |
| :------------- | :------- | :---------------- | :----------------------------------------------------------- |
| scene          | 是       | 字符串            | 检测场景，和调用请求中的场景对应。                           |
| label          | 是       | 字符串            | 检测结果的分类，与具体的scene对应。取值范围参考scene 和 label说明。 |
| score          | 是       | 浮点数            | 结果为该分类的概率，取值范围为[0.00-100.00](https://cf.jd.com/pages/0.00-100.00)。值越高，表示越有可能属于该分类subLabel。 |
| suggestion     | 是       | 字符串            | 建议用户执行的操作，取值范围：pass，review，block            |
| extras         | 否       | JSON对象          | 附加信息，扩展字段。                                         |
| frames         | 否       | frame数组         | 判断为该分类的一些截帧检测结果（FrameScanResult），截帧检测结果表的具体结构描述见frame。 |
| hintWordsInfos | 否       | hintWordsInfo数组 | 视频中含有广告时，返回视频中广告文字命中的风险关键词信息。格式为数组，具体结构描述见hintWordsInfo |
| logoData       | 否       | 数组              | 图片中含有logo时，返回识别出来的logo信息，具体结构描述见logoData。 |
| sfaceData      | 否       | 数组              | 视频中包含暴恐识涉政内容时，返回识别出来的暴恐涉政信息，具体结构描述见sfaceData。 |

##### frame

| 参数名称 | 是否必须 | 类型   | 描述                                                         |
| :------- | :------- | :----- | :----------------------------------------------------------- |
| url      | 否       | 字符串 | 截帧地址。                                                   |
| offset   | 否       | 整型   | 该截帧距离片头的时间戳，单位为秒。                           |
| label    | 是       | 字符串 | 该视频截帧的风险分类，取值范围请参见scene和label参数说明。   |
| score    | 是       | 浮点数 | 该视频截帧结果为label所述分类的概率，取值范围为[0.00-100.00](https://cf.jd.com/pages/0.00-100.00)。值越高，表示越有可能属于该分类。 |

##### logoData

| 参数名称 | 是否必须 | 类型   | 描述                                              |
| :------- | :------- | :----- | :------------------------------------------------ |
| type     | 是       | 字符串 | 识别出的logo类型，取值为TV （台标）。             |
| name     | 是       | 字符串 | 识别出的logo名称。                                |
| x        | 是       | 浮点数 | 以图片左上角为坐标原点，logo区域左上角到y轴距离。 |
| y        | 是       | 浮点数 | 以图片左上角为坐标原点，logo区域左上角到x轴距离。 |
| w        | 是       | 浮点数 | logo区域宽度。                                    |
| h        | 是       | 浮点数 | logo区域高度。                                    |

##### sfaceData

| 参数名称 | 是否必须 | 类型   | 描述                                                |
| :------- | :------- | :----- | :-------------------------------------------------- |
| x        | 是       | 浮点数 | 以图片左上角为坐标原点，人脸码区域左上角到y轴距离。 |
| y        | 是       | 浮点数 | 以图片左上角为坐标原点，人脸区域左上角到x轴距离。   |
| w        | 是       | 浮点数 | 人脸区域宽度。                                      |
| h        | 是       | 浮点数 | 人脸区域高度。                                      |
| faces    | 否       | 数组   | 识别出的人脸信息，具体结构描述见face。              |

##### face

| 参数名称 | 是否必须 | 类型   | 描述         |
| :------- | :------- | :----- | :----------- |
| name     | 否       | 字符串 | 相似人物名称 |
| rate     | 否       | 浮点数 | 相似概率     |
| id       | 是       | 字符串 | 人脸id       |

##### audioScanResult

| 参数名称   | 是否必须 | 类型       | 描述                                                         |
| :--------- | :------- | :--------- | :----------------------------------------------------------- |
| scene      | 是       | 字符串     | 检测场景，和调用请求中的场景对应。                           |
| label      | 是       | 字符串     | 检测结果的分类，与具体的scene对应。取值范围参考scene 和 label说明。 |
| score      | 是       | 字符串     | 结果为该分类的概率，取值范围为[0.00-100.00](https://cf.jd.com/pages/0.00-100.00)。值越高，表示越有可能属于该分类subLabel。 |
| suggestion | 是       | 字符串     | 建议用户执行的操作，取值范围：pass，review，block            |
| details    | 是       | detail数组 | 语音对应的文本详情（每一句文本对应一个元素），包含一个或者多个元素，具体结构描述见detail。 |

##### detail

| 参数名称  | 是否必须 | 类型   | 描述                                                         |
| :-------- | :------- | :----- | :----------------------------------------------------------- |
| startTime | 是       | 整型   | 句子开始的时间，单位是秒。                                   |
| endTime   | 是       | 整型   | 句子结束的时间，单位是秒。                                   |
| text      | 是       | 字符串 | 语音转换成文本的结果。                                       |
| label     | 是       | 字符串 | 该句语言的检测结果的分类，取值参见audioScenes与label参数说明。 |

#### 请求示例

```
["taskid1"]
```

#### 响应示例

```
{
	"code": 200,
	"requestId": "requestID xxx",
	"result": {
		"data": [{
			"code": 200,
			"msg": "OK",
			"dataId": "videoId xxx",
			"taskId": "taskId xxx",
			"results": [{
				"label": "porn",
				"score": 99.2,
				"scene": "porn",
				"suggestion": "block"
			}],
			"audioScanResults": [{
				"scene": "antispam",
				"label": "customized",
				"suggestion": "block",
				"score": 99.91,
				"details": [{
						"startTime": 0,
						"endTime": 24,
						"text": "blabla...",
						"label": "customized"
					},
					{
						"startTime": 24,
						"endTime": 60,
						"text": "blabla...",
						"label": "normal"
					}
				]
			}]
		}]
	}
}
```



