# 创建监听策略

##### 1. 通过网络负载均衡-详情-监听器进入监听器管理页；

##### 2. 点击新建监听器，打开监听器设置页；

##### 3. 根据用户需求，配置监听器各参数：
	
###### 前端监听配置：
	
- 监听协议和端口：网络负载均衡监听的客户端请求的协议类型，仅支持TCP。监听端口号取值范围为1~65535。同一网络负载均衡下的监听端口不可重复，监听器创建后，监听协议和端口不允许修改。

- 空闲连接超时：输入范围1~86400秒，默认1800秒。

![NLB前端监听配置](../../../../image/Networking/NLB/NLB-022.png)

###### 后端转发配置：

- 默认后端服务：新建或选择一个已有的后端服务，选择已有后端服务相关参数不可修改；

- 后端服务名称：定义后端服务名称，随监听器同步创建的后端服务可在后端服务列表查看；	
	
- 后端协议：默认显示，如监听协议为tcp则后端协议为tcp；
	
- 端口：后端业务转发端口，取值范围1~65535，不同后端服务的端口可以重复；
	
- 调度算法：加权轮询、加权最小连接数、源IP，可根据实际业务需求选择；

- 会话保持：默认关闭，打开支持基于TCP的会话保持；	
	
- 连接耗尽：配置连接耗尽超时时间，取值范围为0~3600秒，缺省为300秒。
 
      注意：创建后端服务时，后端服务默认未开启通过代理协议V2携带客户端源IP功能，如需开启，请在编辑后端服务中打开该功能。

![NLB后端转发配置](../../../../image/Networking/NLB/NLB-023.png)	

###### 健康检查设置：

- 选择健康检查方式：HTTP、TCP；
	
- 设置检查端口：取值范围为1~65535，如不填写默认为后端实例接收负载均衡流量的端口；
	
- 响应超时时间(s)：取值范围为2~60秒,此为健康检查响应的最大超时时间；
	
- 健康检查间隔(s):取值范围为5~300秒,此为健康检查的时间间隔；
	
- 不健康阈值：取值范围为1~5，此为后端实例从成功到失败的连续健康检查失败次数；
	
- 健康阈值：取值范围为1~5，此为后端实例从失败到成功的连续健康检查成功次数；
	
- 正常态码：仅健康检查方式为HTTP时填写，取值范围为2xx（等价于200-299）、3xx（等价于300-399）、4xx（等价于400-499）；
	
- 检查路径：仅健康检查方式为HTTP时填写，必须以“/”开头，不得超过1000字符，不支持输入“"”字符。

![NLB健康检查设置](../../../../image/Networking/NLB/NLB-029.png)

###### 添加服务器组：

- 选择服务器组类型：虚拟服务器、高可用组或者暂不添加。

- 虚拟服务器组：系统会自动筛选出当前可以绑定的服务器组列表，如没有可用的服务器组，可点击“新建虚拟服务器组”进行创建。可选服务器组中的后端实例必须与负载均衡处于相同地域的同一私有网络；

- 高可用组：系统会自动筛选出当前可以绑定的高可用组，如没有可用的高可用组，请前往高可用组页面进行创建。可选高可用组中的后端实例必须与负载均衡处于相同地域的同一私有网络。

![NLB添加服务器组](../../../../image/Networking/NLB/NLB-030.png)
