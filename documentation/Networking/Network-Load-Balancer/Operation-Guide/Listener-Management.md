# 监听器管理

监听器管理用来指导您新建一个监听器和管理已有监听器。
- 新建监听器：新建监听器向导将指引您如何新建一个监听器。该向导包括前端监听配置、后端转发配置、健康检查配置和后端服务器组配置四部分。
- 管理监听器：您可以对已有监听器进行启用/禁用、编辑、删除等操作。

## 操作步骤

### 步骤一：前端监听配置

 1.您可以在网络负载均衡列表页通过以下两种方式，进入监听器列表页。
 
   - 点击 **名称**  栏下的指定网络负载均衡，进入该网络负载均衡详情页。点击 **监听器** 页签，进入监听器列表页。
   - 点击 **操作** 栏下的 **添加监听** 链接，进入监听器列表页。

 2.点击 **新建监听器** 按钮，在弹出的配置向导对话框中配置监听协议、端口及空闲连接超时，点击 **下一步** 进入后端转发配置页签。
 
 | 参数	| 说明	| 
| :- | :- |
|监听协议	|前端的监听协议，目前仅支持TCP|
|端口	|前端的监听端口，输入范围为1-65535，同一NLB下，监听端口不能重复|
|空闲连接超时|输入范围为1-86400秒，默认1800秒|
 
     注意：监听协议和端口配置后不允许修改。
     
### 步骤二：后端转发配置

 1.选择默认后端服务类型：
 
   - 如网络负载均衡下没有后端服务或现有后端服务不能满足业务需求，请选择 **新建后端服务**。
   - 如网络负载均衡下已有后端服务满足业务需求，可选择 **选择后端服务**，新建监听器将与其他监听器共用选择的后端服务。

 2.如新建后端服务，请配置后端服务名称、后端协议等参数。
 
| 参数	| 说明	| 
| :- | :- |
|后端协议	|后端服务器提供服务时使用的协议。因为前端监听协议仅支持TCP，本参数默认显示为TCP|
|端口	|后端服务器接收服务请求的端口，输入范围为1-65535。不同后端服务的端口可以重复|
|调度算法|网络负载均衡将服务请求分发到后端服务器的算法，取值包括加权轮询、加权最小连接数和源IP，可根据实际业务需求选择|
|会话保持|默认关闭，打开支持基于TCP的会话保持，缺省时间为300秒|
|连接耗尽|配置连接耗尽超时时间，输入范围为0~3600秒，缺省为300秒|

     注意：FSR模式的NLB可直接透传客户端源IP；FullNAT模式的NLB可通过代理协议V2携带客户端源IP，该功能默认关闭，可通过修改后端服务开启该功能。

3.点击 **下一步** 进入健康检查配置页签。

##### 健康检查设置：


1.配置向导中健康检查默认开启，可配置健康检查参数。如您需将其关闭，请在后端服务的编辑对话框中进行操作。
 
| 参数	| 说明	| 
| :- | :- |
|健康检查方式|对后端服务器进行健康检查时的探测协议，包括HTTP和TCP|
|检查端口|对后端服务器进行健康检查时的探测端口，输入范围为1-65535。如不填写本参数，默认使用后端服务器端口|
|响应超时时间(s)|健康检查响应的最大超时时间。如在指定时间内未接收到后端服务器的正确响应，网络负载均衡将判定该后端服务器为异常。输入范围为2-60秒|
|健康检查间隔(s)|对后端服务器进行健康检查的时间间隔。输入范围为5-300秒|
|不健康阈值|对后端服务器从成功到失败的连续健康检查失败次数。输入范围为1-5|
|健康阈值|对后端实例从失败到成功的连续健康检查成功次数。输入范围为1-5|
|正常态码|仅健康检查方式为HTTP时填写，输入范围2xx（等价于200-299）、3xx（等价于300-399）、4xx（等价于400-499）|
|检查路径|仅健康检查方式为HTTP时填写，必须以“/”开头，不得超过1000字符，不支持输入“"”|

2.点击 **下一步** 进入后端服务器组配置页签。
 
### 步骤四：后端服务器组配置
1.选择服务器组类型：虚拟服务器组/实例类型、虚拟服务器组/IP类型（仅FullNAT模式的NLB支持）、高可用组或暂不添加。

   - 选择虚拟服务器组/实例类型、虚拟服务器组/IP类型：系统会自动筛选出当前可以绑定的虚拟服务器组列表，如没有可用的虚拟服务器组，可点击 **新建服务器组** 进行创建。
   - 选择高可用组：系统会自动筛选出当前可以绑定的高可用组，如没有可用的高可用组，请前往高可用组页面进行创建。

2.如选择新建虚拟服务器组，页面自动跳转到虚拟服务器组列表页。请参见[虚拟服务器组管理](../Operation-Guide/TargetGroup-Management.md)新建一个虚拟服务器组。

3.选择新建的虚拟服务器组名称，点击 **确定** 按钮，完成创建监听器的操作。

## 管理监听器

 1.查看监听器详情：点击 **监听协议:端口**  栏下的指定监听器，进入详情页查看其详细信息。

 2.启用/禁用监听器：点击 **操作** 栏下的 **启用/禁用**，可启用或禁用该监听器。
 
 3.编辑监听器：点击 **操作** 栏下的 **编辑**，在弹出的对话框中可修改监听器绑定的后端服务和空闲连接超时。
  
 4.删除监听器：点击 **操作** 栏下的 **删除**，可删除指定监听器。
 
 5.查看后端服务详情：点击 **默认后端服务**  栏下的指定后端服务，可查看监听器绑定的后端服务的详细信息。
 
 6.查看后端服务器信息：点击 **服务器组**  栏下的指定服务器组，可查看组内所有后端服务器的健康状态等信息。
	


